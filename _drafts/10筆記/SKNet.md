## å‰è¨€
SKNet å¯ä»¥èªªæ˜¯ SENet çš„å­¿ç”Ÿå…„å¼Ÿã€‚é¦–å…ˆ SENet æ¡ç”¨é€šé“æ³¨æ„åŠ›æ©Ÿåˆ¶ï¼Œä¸€å¼µç‰¹å¾µåœ–æœ‰å¤šå°‘å€‹é€šé“(c)å°±åˆ†æˆå¤šå°‘çš„ 1*c å‘é‡(æ¯å¼µåœ–é€éå…¨å±€å¹³å‡æ± åŒ–)ï¼Œç„¶å¾Œé€šéæ³¨æ„åŠ›æ©Ÿåˆ¶ï¼Œä½¿å¾—æ¯å€‹é€šé“çš„é‡è¦æ€§ç¨‹åº¦ä¸ä¸€æ¨£ã€‚ç„¶è€Œ SKNet ä¸»è¦æ˜¯æ˜¯çµåˆ Inception å’Œ ResNeXt çš„å„ªé»ä¸¦åŠ å…¥äº† SENet å°æ–¼é€šé“æ³¨æ„åŠ›çš„æƒ³æ³•ã€‚é–“å–®ä¾†èªªæ­¤è«–æ–‡æå‡ºçš„ SK block æ˜¯åœ¨ ResNeXt block çš„åŸºç¤ä¹‹ä¸Šï¼Œä¸¦åŠ ä¸Šå¤šåˆ†æ”¯èˆ‡æ³¨æ„åŠ›æ©Ÿåˆ¶ã€‚SKNet å¯ä»¥èªªæ˜¯å•Ÿç™¼è‡ªçš®è³ªç¥ç¶“å…ƒæ ¹æ“šä¸åŒçš„åˆºæ¿€å¯å‹•æ…‹èª¿ç¯€å…¶è‡ªèº«çš„æ„Ÿå—é‡ã€‚

- è«–æ–‡ï¼š [Selective Kernel Networks](https://arxiv.org/abs/1903.06586) (CVPR 2019)
- ç¨‹å¼ç¢¼ï¼š [GitHub](https://github.com/implus/SKNet)

## è§£æ Selective Kernel Unitï¼ˆSK blockï¼‰
SKNet åœ¨ä¸€ç¯‡é›»è…¦è¦–è¦ºæ³¨æ„åŠ›æ©Ÿåˆ¶ç¸½çµçš„[è«–æ–‡](https://arxiv.org/abs/2111.07624)ä¸­è¢«æ­¸é¡ç‚ºåˆ†æ”¯æ³¨æ„åŠ›æ©Ÿåˆ¶(Branch Attention)çš„æ‡‰ç”¨ã€‚ç›®çš„æ˜¯è®“ç¥ç¶“ç¶²è·¯è‡ªé©æ‡‰èª¿æ•´æ„Ÿå—é‡ï¼Œå‹•æ…‹çš„å»é‡çµ„é€™äº›ç‰¹å¾µï¼Œä¸¦ä¸åƒ Inception ä¸€æ¨£å»æ‹¼æ¥å¾ˆå¤šç‰¹å¾µåœ–ã€‚ä¸€å€‹ SK block ç¶²è·¯ä¸»è¦åˆ†æˆä¸‰å€‹æ­¥é©Ÿï¼šSplitã€Fuse ã€Selectã€‚

![](https://i.imgur.com/m3ODi9x.png)

### 1. Split
é€™ä¸€æ­¥é©Ÿä¸»è¦æ˜¯é€éä¸åŒçš„å·ç©æ ¸å°ç›¸åŒçš„è¼¸å…¥é€²è¡Œå·ç©å¾—åˆ°ä¸åŒçš„ç‰¹å¾µåœ–ã€‚é¦–å…ˆçµ¦å®šä¸€å€‹è¼¸å…¥ X (ç‰¹å¾µåœ–)ï¼Œä¸¦åŸ·è¡Œå…©å€‹å·ç©è½‰æ› (Transformation)ã€‚å…¶ä¸­ä¸€å€‹å·æ©Ÿæ ¸ç‚º 3 å¦ä¸€å€‹ç‚º 5ï¼Œç¶“éå·ç©éå¾Œåˆ†åˆ¥å¾—åˆ° U~ èˆ‡ U^ å…©å€‹ç‰¹å¾µåœ–ã€‚ä½¿ç”¨å…©ç¨®ä¸åŒ kernel å¤§å°çš„å·ç©çš„å«ç¾©å³æœ‰ä¸åŒçš„æ„Ÿå—é‡ï¼Œè€Œéš¨å¾Œçš„ Fuse å°±æ˜¯åƒè€ƒ SENet é€šé“æ³¨æ„åŠ›çš„æ¦‚å¿µèƒå–é‡è¦çš„è³‡è¨Šã€‚ç•¶ç„¶åˆ†æ”¯çš„æ•¸é‡å¯ä»¥ä¸é™ï¼Œè«–æ–‡ä¸­ä¹Ÿæœ‰é€²è¡Œå››å€‹åˆ†æ”¯çš„å¯¦é©—ï¼Œä½†å¯¦é©—çµæœè¡¨æ˜å…©å€‹åˆ†æ”¯æ•¸å°±æœ‰ä¸éŒ¯çš„æ•ˆæœäº†ã€‚å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯æ­¤æ­¥é©Ÿçš„å·ç©æ“ä½œæ˜¯æ¡ç”¨ Grouped/depthwise/dilated convolutionsï¼Œç‚ºäº†è¿‘ä¸€æ­¥æå‡æ•ˆç‡é€™è£¡çš„ 5*5 å·ç©æ ¸ç”¨ dilation=2 çš„ç©ºæ´å·ç©ä»£æ›¿ã€‚

![](https://i.imgur.com/7MgZWX0.png)

### 2. Fuse
ç¬¬äºŒæ­¥é©Ÿç‚ºå‹•æ…‹çš„èª¿æ•´æ„Ÿå—é‡ï¼Œä¸€å€‹ç›´æ¥çš„æƒ³æ³•æ˜¯ç”¨é–€æ§ (Gate) ä¾†æ§åˆ¶å¤šåˆ†æ”¯çš„è¨Šæ¯æµã€‚æ‰€ä»¥åœ¨èª¿æ•´ä¹‹å‰ï¼Œæ‡‰è©²å…ˆå°‡å¤šåˆ†æ”¯çš„è¨Šæ¯é€²è¡Œæ•´åˆã€‚æˆ‘å€‘å·²ç¶“é€éå‰ä¸€å€‹æ­¥é©Ÿå¾—åˆ° `3*3` èˆ‡ `5*5` çš„æ„Ÿå—é‡ä¸¦ä¸”é€é element wise summation ç›¸åŠ èåˆåˆ°åˆ°ä¸€å€‹ç‰¹å¾µåœ– Uã€‚

![](https://i.imgur.com/wddlOTR.png)

å°‡å¤šè·¯åˆ†æ”¯çš„ç‰¹å¾µåœ–é€²è¡Œèåˆä¹‹å¾Œå¾—åˆ°ä¸€å€‹ç‰¹å¾µåœ– Uï¼Œå°æ•´åˆå¾Œçš„è¨Šæ¯å°é€šé“ç¶­åº¦ä½¿ç”¨å…¨å±€å¹³å‡æ± åŒ–ã€‚æ¥ä¸‹ä¾†çš„æ­¥é©Ÿæœ‰é»é¡ä¼¼ SKNet é€šé“æ³¨æ„åŠ›çš„è¨ˆç®—æ–¹å¼ï¼Œä½†æœ€å¾Œè¨ˆç®—æ³¨æ„åŠ›åˆ†æ•¸çš„æ–¹å¼å°‡ç¨å¾®ä¸åŒã€‚åœ¨é€™ä¸€æ­¥é©Ÿå°ç‰¹å¾µåœ– U åšä¸€å€‹å…¨å±€å¹³å‡æ± åŒ–å¾—åˆ°ä¸€å€‹ S çš„ä¸€ç¶­å‘é‡(æ­¤æ­¥é©Ÿè·Ÿ SENet çš„ Excitation ä¸€æ¨£)ã€‚ä¹‹å¾Œå†å° S éä¸€å€‹å…¨é€£æ¥å±¤ï¼Œå…ˆé€²è¡Œ batch normalization å†é relu æ¿€ç™¼æœ€å¾Œå¾—åˆ°ä¸€å€‹ c/r çš„é™ç¶­å‘é‡ z (æœ€å¤§ç¶­åº¦=32)ã€‚

![](https://i.imgur.com/LZAdc3I.png)

### 3. Select
åŸå§‹çš„ SENet æ˜¯ç¶“éå…©å€‹å…¨é€£æ¥å±¤å…ˆé™ç¶­å†å‡ç¶­è‡³åŸä¾†å¤§å°(`1*1*c`)æœ€å¾Œæ˜¯ç”¨ sigmoid ä¾†è¨ˆç®—æ¯å€‹é€šé“çš„æ³¨æ„åŠ›åˆ†æ•¸ã€‚ç„¶è€Œåœ¨ SKNet ä¸­éœ€è¦æŠŠé€™å€‹é™ç¶­å¾Œçš„ z å‘é‡è¨ˆç®—æ³¨æ„åŠ›å‘é‡ã€‚å› ç‚ºæœ‰å…©è·¯åˆ†æ”¯å› æ­¤æœƒæœ‰ ï½å’Œ b å…©å€‹æ³¨æ„åŠ›å‘é‡ï¼Œåˆ†åˆ¥ä»£è¡¨æ‡‰è©²é—œæ³¨åŸç‰¹å¾µåœ– U~ å’Œ U^ çš„å“ªäº›å…§å®¹ã€‚é€™è£¡ ac å’Œ bc å°±æ˜¯ ğ‘¼~ å’Œ ğ‘¼^ å°æ‡‰çš„æ³¨æ„åŠ›å‘é‡(å…©å…©ä¸€çµ„)ï¼Œå…¶ä¸­ ağ’„ ä»£è¡¨ç¬¬ C è¡Œï¼Œä¹Ÿå°±æ˜¯ ac æ˜¯ a çš„ç¬¬ C å€‹å…ƒç´ ã€‚å› æ­¤ a1+b1=1ã€a2+b2=1 æ‰€ä»¥é€™ä¹Ÿå°±æ˜¯ç‚ºä½•è¦æ¡ç”¨ softmax åŸå› ï¼Œå› ç‚ºè¦ç¢ºä¿åŒä¸€ç¶­åº¦çš„æ³¨æ„åŠ›åˆ†æ•¸åŠ ç¸½è¦ç­‰æ–¼1ã€‚å…©è·¯åˆ†æ”¯çš„æ³¨æ„åŠ›åˆ†æ•¸è¨ˆç®—å®Œç•¢å¾Œå°±å¯ä»¥å°å„è‡ªåŸåœ–é€²è¡Œ element-wise multiplication å¾—åˆ°åˆ†æ”¯çš„æ³¨æ„åŠ›ç‰¹å¾µåœ–ï¼Œæœ€å¾Œå† element-wise summation èåˆèµ·ä¾†å¾—åˆ°æœ€çµ‚çš„è¼¸å‡º Vã€‚æ­¤æ™‚çš„ V æ˜¯å°è¼¸å…¥ X é€²è¡Œè‡ªé©æ‡‰èª¿ç¯€ï¼Œå¾—åˆ°ä¸€å€‹æ›´ç²¾ç¢ºçš„æ„Ÿå—é‡è³‡è¨Šã€‚

![](https://i.imgur.com/EG30taR.png)

> å¤§å®¶å¯ä»¥åƒè€ƒ[ç¯„ä¾‹ç¨‹å¼ç¢¼](https://liaowc.github.io/blog/SKNet-structure/)ï¼Œè©²æ–‡ä¸­ä½¿ç”¨ PyTorch æ­å»ºä¸€å€‹ SK blockã€‚

## å¯¦é©—çµæœ
ä½œè€…ä»¥ ResNeXt ä½œç‚º Backbone åµŒå…¥ä¸åŒæ³¨æ„åŠ›æ©Ÿåˆ¶æ¨¡å¡Šé€²è¡Œç¶²è·¯å°æ¯”ã€‚æœ¬ç¯‡è«–æ–‡æå‡ºä¾†çš„æ–¹æ³•é›–ç„¶åœ¨æº–ç¢ºè·¯ä¸Šé¢æœ‰å¾—åˆ°é‡å¤§çš„å‰µèˆ‰ã€‚ä½†æ˜¯è®“æˆ‘å€‘çŸ¥é“å¯ä»¥å¾ä¾‹å¤–ä¸€å€‹è§’åº¦ä½¿ç”¨æ³¨æ„åŠ›è§£æ±ºé›»è…¦è¦–è¦ºä¸Šçš„å•é¡Œã€‚

![](https://i.imgur.com/eApGDNn.png)

ç¶“éåˆ†æä½œè€…ç™¼ç¾åœ¨å¤§å¤šæ•¸é€šé“ä¸­ï¼Œç•¶ç›®æ¨™ç‰©å¢å¤§æ™‚(2.0x) 5*5 å·ç©æ ¸ç›¸å°æ‰€ä½”çš„æ¬Šé‡ä¹Ÿæœƒå¢åŠ ã€‚å› ç‚ºè¼ƒå¤§çš„å·ç©æ ¸è¦–é‡æ¯”è¼ƒå¤§ï¼Œå› æ­¤å¯¦é©—çµæœä¹Ÿç¬¦åˆæˆ‘å€‘é æœŸã€‚å¦å¤–ä¸€å€‹ç™¼ç¾æ˜¯ï¼Œä¸Šè¿°çš„ç¾è±¡åªç™¼ç”Ÿåœ¨ä¸­æ·ºå±¤ç¶²è·¯ä¸­ã€‚ç„¶è€Œåœ¨æ·±å±¤ç¶²è·¯ä¸­é€™å€‹ç¾è±¡ä¸­ä¼¼ä¹æ¶ˆå¤±äº†ã€‚é€™æ˜¯å› ç‚ºåœ¨æ·±å±¤ç¶²è·¯ä¸­å°æ–¼åŸå§‹çš„å½±åƒå°ºåº¦é€æ¼¸æ¶ˆå¤±äº†ï¼Œå› æ­¤å°æ–¼ç‰©é«”çš„ pattern ä¹Ÿç›¸å°æ‡‰æ›´æ¨¡ç³Šé›£ä»¥è¡¨å¾µåŸå§‹çš„æ¨£è²Œã€‚å› æ­¤å°æ–¼å¤§ç‰©é«”ä¾†èªªä¸­å¾ŒæœŸçš„ç¶²è·¯å±¤å°æ–¼å¤§çš„å·ç©æ ¸çš„ç¾è±¡ä¸å¾©å­˜åœ¨äº†ã€‚ä½œè€…è¡¨ç¤ºåœ¨æ·±å±¤çš„ç¶²è·¯ä¸­ï¼Œç‰¹å¾µçš„å¤šå°ºåº¦è¨Šæ¯æœƒè¢«åˆ†è§£ï¼Œæ‰€ä»¥å°æ–¼1.0Ã—ã€1.5Ã—ã€2.0Ã— ç­‰ä¸åŒå°ºåº¦çš„ç›®æ¨™å°è±¡ï¼ŒSKNet æ²’æœ‰æ˜ç¢ºçš„å‚¾å‘å»é¸æ“‡æ›´å¤§æˆ–æ›´å°çš„ kernelã€‚

![](https://i.imgur.com/Atpx7Yy.png)

> é€™è®“æˆ‘å€‘å¯©æ€æ˜¯å¦åœ¨é€²è¡Œæ¨¡å‹ç ”ç©¶æ™‚ï¼Œå°ˆæ³¨æ–¼æ¨¡å‹æ·ºå±¤çš„è¨­è¨ˆæœƒå¿«é€Ÿé”åˆ°æ•ˆæœï¼Ÿ

## Reference
- [ï¼ˆSKNetï¼‰Selective Kernel Network è§£æ](https://zhuanlan.zhihu.com/p/357206967)
- [SK-Net (Selective Kernel Networks) æ¶æ§‹ä»‹ç´¹](https://liaowc.github.io/blog/SKNet-structure/)